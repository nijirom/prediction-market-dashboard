<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Prediction Market Irregularity Tracker</title>
    <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.7/dist/chart.umd.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/chartjs-plugin-annotation@3.1.0/dist/chartjs-plugin-annotation.min.js"></script>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;800;900&family=JetBrains+Mono:wght@400;500;600&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="styles.css">
</head>
<body>
    <!-- Ambient background effects -->
    <div class="ambient-glow glow-1"></div>
    <div class="ambient-glow glow-2"></div>
    <div class="ambient-glow glow-3"></div>

    <!-- Header -->
    <header class="dashboard-header">
        <div class="header-content">
            <div class="header-left">
                <div class="logo-mark">
                    <svg width="32" height="32" viewBox="0 0 32 32" fill="none">
                        <rect x="2" y="2" width="28" height="28" rx="6" stroke="url(#logo-grad)" stroke-width="2.5"/>
                        <path d="M9 22L13 12L17 18L21 8L23 12" stroke="url(#logo-grad)" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                        <circle cx="13" cy="12" r="2" fill="#6366f1"/>
                        <circle cx="21" cy="8" r="2" fill="#f43f5e"/>
                        <defs>
                            <linearGradient id="logo-grad" x1="0" y1="0" x2="32" y2="32">
                                <stop stop-color="#6366f1"/>
                                <stop offset="1" stop-color="#f43f5e"/>
                            </linearGradient>
                        </defs>
                    </svg>
                </div>
                <div>
                    <h1>Market Irregularity Tracker</h1>
                    <p class="header-subtitle">Prediction Market Microstructure Analysis &middot; Based on 72.1M Trades</p>
                </div>
            </div>
            <div class="header-right">
                <div class="live-indicator">
                    <span class="pulse-dot"></span>
                    <span>Simulation Active</span>
                </div>
                <div class="header-stat">
                    <span class="stat-label">Trades Analyzed</span>
                    <span class="stat-value" id="trade-counter">72,100,000</span>
                </div>
                <div class="header-stat">
                    <span class="stat-label">Volume</span>
                    <span class="stat-value">$18.26B</span>
                </div>
            </div>
        </div>
    </header>

    <!-- Alert Banner -->
    <div class="alert-banner" id="alert-banner">
        <div class="alert-content">
            <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                <path d="M10.29 3.86L1.82 18a2 2 0 0 0 1.71 3h16.94a2 2 0 0 0 1.71-3L13.71 3.86a2 2 0 0 0-3.42 0z"/>
                <line x1="12" y1="9" x2="12" y2="13"/><line x1="12" y1="17" x2="12.01" y2="17"/>
            </svg>
            <span id="alert-text">Anomaly detected: Entertainment category showing 4.79pp maker-taker gap — 28x Finance baseline</span>
            <button class="alert-dismiss" onclick="dismissAlert()">×</button>
        </div>
    </div>

    <!-- Main Dashboard -->
    <main class="dashboard-main">

        <!-- KPI Cards Row -->
        <section class="kpi-row">
            <div class="kpi-card kpi-negative">
                <div class="kpi-icon">
                    <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><polyline points="23 6 13.5 15.5 8.5 10.5 1 18"/><polyline points="17 6 23 6 23 12"/></svg>
                </div>
                <div class="kpi-data">
                    <span class="kpi-label">Taker Avg Return</span>
                    <span class="kpi-value" id="kpi-taker-return">-1.12%</span>
                    <span class="kpi-delta negative">▼ Losing Population</span>
                </div>
            </div>
            <div class="kpi-card kpi-positive">
                <div class="kpi-icon">
                    <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><polyline points="23 18 13.5 8.5 8.5 13.5 1 6"/><polyline points="17 18 23 18 23 12"/></svg>
                </div>
                <div class="kpi-data">
                    <span class="kpi-label">Maker Avg Return</span>
                    <span class="kpi-value" id="kpi-maker-return">+1.12%</span>
                    <span class="kpi-delta positive">▲ Extracting Value</span>
                </div>
            </div>
            <div class="kpi-card kpi-warning">
                <div class="kpi-icon">
                    <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><circle cx="12" cy="12" r="10"/><line x1="12" y1="8" x2="12" y2="12"/><line x1="12" y1="16" x2="12.01" y2="16"/></svg>
                </div>
                <div class="kpi-data">
                    <span class="kpi-label">Optimism Tax</span>
                    <span class="kpi-value" id="kpi-optimism-tax">1.85pp</span>
                    <span class="kpi-delta warning">YES vs NO gap</span>
                </div>
            </div>
            <div class="kpi-card kpi-info">
                <div class="kpi-icon">
                    <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M12 22s8-4 8-10V5l-8-3-8 3v7c0 6 8 10 8 10z"/></svg>
                </div>
                <div class="kpi-data">
                    <span class="kpi-label">Longshot Mispricing</span>
                    <span class="kpi-value" id="kpi-longshot">-57%</span>
                    <span class="kpi-delta info">At 1¢ contracts</span>
                </div>
            </div>
            <div class="kpi-card kpi-neutral">
                <div class="kpi-icon">
                    <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><rect x="3" y="3" width="18" height="18" rx="2"/><line x1="3" y1="9" x2="21" y2="9"/><line x1="9" y1="21" x2="9" y2="9"/></svg>
                </div>
                <div class="kpi-data">
                    <span class="kpi-label">Max Category Gap</span>
                    <span class="kpi-value" id="kpi-max-gap">7.32pp</span>
                    <span class="kpi-delta neutral">World Events</span>
                </div>
            </div>
        </section>

        <!-- Chart Grid -->
        <section class="chart-grid">

            <!-- Longshot Bias Calibration -->
            <div class="chart-card chart-large">
                <div class="chart-header">
                    <div>
                        <h3>Longshot Bias Calibration Curve</h3>
                        <p class="chart-desc">Implied probability vs actual win rate — deviation from the 45° line reveals mispricing</p>
                    </div>
                    <div class="chart-controls">
                        <button class="ctrl-btn active" data-chart="calibration" data-view="all">All</button>
                        <button class="ctrl-btn" data-chart="calibration" data-view="taker">Taker</button>
                        <button class="ctrl-btn" data-chart="calibration" data-view="maker">Maker</button>
                    </div>
                </div>
                <div class="chart-body">
                    <canvas id="calibrationChart"></canvas>
                </div>
            </div>

            <!-- Maker-Taker Decomposition -->
            <div class="chart-card chart-large">
                <div class="chart-header">
                    <div>
                        <h3>Maker-Taker Return Decomposition</h3>
                        <p class="chart-desc">Excess return by price level — the structural wealth transfer from takers to makers</p>
                    </div>
                </div>
                <div class="chart-body">
                    <canvas id="makerTakerChart"></canvas>
                </div>
            </div>

            <!-- Category Efficiency -->
            <div class="chart-card">
                <div class="chart-header">
                    <div>
                        <h3>Category Efficiency Spectrum</h3>
                        <p class="chart-desc">Maker-taker gap by category — wider gap = more extraction</p>
                    </div>
                </div>
                <div class="chart-body">
                    <canvas id="categoryChart"></canvas>
                </div>
            </div>

            <!-- YES/NO Asymmetry -->
            <div class="chart-card">
                <div class="chart-header">
                    <div>
                        <h3>YES / NO Asymmetry</h3>
                        <p class="chart-desc">Expected value divergence between YES and NO contracts at equivalent prices</p>
                    </div>
                </div>
                <div class="chart-body">
                    <canvas id="yesNoChart"></canvas>
                </div>
            </div>

            <!-- Temporal Evolution -->
            <div class="chart-card chart-wide">
                <div class="chart-header">
                    <div>
                        <h3>Temporal Evolution of Wealth Transfer</h3>
                        <p class="chart-desc">Quarterly maker-taker gap with volume overlay — the professionalization of liquidity</p>
                    </div>
                    <div class="chart-badge">
                        <span class="badge-dot"></span>
                        Post-election inflection: Q4 2024
                    </div>
                </div>
                <div class="chart-body">
                    <canvas id="temporalChart"></canvas>
                </div>
            </div>

            <!-- Live Anomaly Feed -->
            <div class="chart-card chart-feed">
                <div class="chart-header">
                    <div>
                        <h3>Live Anomaly Detection Feed</h3>
                        <p class="chart-desc">Simulated real-time irregularity scanner across all categories</p>
                    </div>
                    <div class="feed-stats">
                        <span class="feed-count" id="anomaly-count">0</span> anomalies detected
                    </div>
                </div>
                <div class="feed-body" id="anomaly-feed">
                    <!-- Anomalies injected by JS -->
                </div>
            </div>

        </section>

        <!-- Optimism Tax Deep Dive -->
        <section class="deep-dive">
            <div class="deep-dive-header">
                <h2>The Optimism Tax: Deep Dive</h2>
                <p>Takers disproportionately buy YES at longshot prices, paying a structural premium for affirmative outcomes</p>
            </div>
            <div class="deep-dive-grid">
                <div class="dive-card">
                    <div class="dive-metric">
                        <span class="dive-number" id="dive-yes-ev">-1.02%</span>
                        <span class="dive-label">YES Buyer Return</span>
                    </div>
                    <div class="dive-bar-container">
                        <div class="dive-bar dive-bar-negative" style="width: 60%"></div>
                    </div>
                    <p class="dive-explanation">Dollar-weighted excess return for all YES contract buyers</p>
                </div>
                <div class="dive-card">
                    <div class="dive-metric">
                        <span class="dive-number positive" id="dive-no-ev">+0.83%</span>
                        <span class="dive-label">NO Buyer Return</span>
                    </div>
                    <div class="dive-bar-container">
                        <div class="dive-bar dive-bar-positive" style="width: 50%"></div>
                    </div>
                    <p class="dive-explanation">Dollar-weighted excess return for all NO contract buyers</p>
                </div>
                <div class="dive-card">
                    <div class="dive-metric">
                        <span class="dive-number warning">69 / 99</span>
                        <span class="dive-label">Price Levels NO Wins</span>
                    </div>
                    <div class="dive-bar-container">
                        <div class="dive-bar dive-bar-warning" style="width: 70%"></div>
                    </div>
                    <p class="dive-explanation">NO contracts outperform YES at 69 of 99 price levels</p>
                </div>
                <div class="dive-card">
                    <div class="dive-metric">
                        <span class="dive-number danger">64pp</span>
                        <span class="dive-label">Max EV Divergence</span>
                    </div>
                    <div class="dive-bar-container">
                        <div class="dive-bar dive-bar-danger" style="width: 85%"></div>
                    </div>
                    <p class="dive-explanation">At 1¢: YES EV = -41%, NO EV = +23% — a 64pp gap</p>
                </div>
            </div>
        </section>

        <!-- Taker Flow Composition -->
        <section class="chart-grid">
            <div class="chart-card chart-wide">
                <div class="chart-header">
                    <div>
                        <h3>Taker Flow Composition — YES vs NO Volume Share</h3>
                        <p class="chart-desc">At longshot prices (1-10¢), takers account for 41-47% of YES volume vs only 20-24% for makers</p>
                    </div>
                </div>
                <div class="chart-body">
                    <canvas id="flowChart"></canvas>
                </div>
            </div>

            <!-- Volume Distribution -->
            <div class="chart-card">
                <div class="chart-header">
                    <div>
                        <h3>Volume Distribution by Category</h3>
                        <p class="chart-desc">Sports dominates with 72% of all notional volume</p>
                    </div>
                </div>
                <div class="chart-body chart-body-doughnut">
                    <canvas id="volumeChart"></canvas>
                </div>
            </div>
        </section>

    </main>

    <!-- Footer -->
    <footer class="dashboard-footer">
        <div class="footer-content">
            <p>Data source: <a href="https://www.jbecker.dev/research/prediction-market-microstructure" target="_blank">The Microstructure of Wealth Transfer in Prediction Markets</a> by Jonathan Becker</p>
            <p class="footer-note">72.1M trades &middot; $18.26B volume &middot; 7.68M markets &middot; Dashboard visualization of research findings</p>
        </div>
    </footer>

    <script src="app.js"></script>
</body>
</html>
